---
title: Test su Loom
actions: ['checkAnswer', 'hints']
material:
  editor:
    language: javascript
    startingCode:
      'truffle.js': |
        const HDWalletProvider = require("truffle-hdwallet-provider");
        const LoomTruffleProvider = require('loom-truffle-provider');
        const mnemonic = "YOUR MNEMONIC HERE";
        module.exports = {
            // Object with configuration for each network
            networks: {
                //development
                development: {
                    host: "127.0.0.1",
                    port: 7545,
                    network_id: "*",
                    gas: 9500000
                },
                // Configuration for Ethereum Mainnet
                mainnet: {
                    provider: function() {
                        return new HDWalletProvider(mnemonic, "https://mainnet.infura.io/v3/<YOUR_INFURA_API_KEY>")
                    },
                    network_id: "1" // Match any network id
                },
                // Configuration for Rinkeby Metwork
                rinkeby: {
                    provider: function() {
                        // Setting the provider with the Infura Rinkeby address and Token
                        return new HDWalletProvider(mnemonic, "https://rinkeby.infura.io/v3/<YOUR_INFURA_API_KEY>")
                    },
                    network_id: 4
                },
                // Configuration for Loom Testnet
                loom_testnet: {
                    provider: function() {
                        const privateKey = 'YOUR_PRIVATE_KEY';
                        const chainId = 'extdev-plasma-us1';
                        const writeUrl = 'wss://extdev-basechain-us1.dappchains.com/websocket';
                        const readUrl = 'wss://extdev-basechain-us1.dappchains.com/queryws';
                        // TODO: Replace the line below
                        return new LoomTruffleProvider(chainId, writeUrl, readUrl, privateKey);
                    },
                    network_id: '9545242630824'
                }
            },
            compilers: {
                solc: {
                    version: "0.4.25"
                }
            }
        };

    answer: |
      const HDWalletProvider = require("truffle-hdwallet-provider");
      const LoomTruffleProvider = require('loom-truffle-provider');
      const mnemonic = "YOUR MNEMONIC HERE";
      module.exports = {
          // Object with configuration for each network
          networks: {
              //development
              development: {
                  host: "127.0.0.1",
                  port: 7545,
                  network_id: "*",
                  gas: 9500000
              },
              // Configuration for Ethereum Mainnet
              mainnet: {
                  provider: function() {
                      return new HDWalletProvider(mnemonic, "https://mainnet.infura.io/v3/<YOUR_INFURA_API_KEY>")
                  },
                  network_id: "1"
              },
              // Configuration for Rinkeby Network
              rinkeby: {
                  provider: function() {
                      return new HDWalletProvider(mnemonic, "https://rinkeby.infura.io/v3/<YOUR_INFURA_API_KEY>")
                  },
                  network_id: 4
              },
              // Configuration for Loom Testnet
              loom_testnet: {
                  provider: function() {
                      const privateKey = 'YOUR_PRIVATE_KEY';
                      const chainId = 'extdev-plasma-us1';
                      const writeUrl = 'wss://extdev-basechain-us1.dappchains.com/websocket';
                      const readUrl = 'wss://extdev-basechain-us1.dappchains.com/queryws';
                      const loomTruffleProvider = new LoomTruffleProvider(chainId, writeUrl, readUrl, privateKey);
                      loomTruffleProvider.createExtraAccountsFromMnemonic(mnemonic, 10);
                      return loomTruffleProvider;
                  },
                  network_id: '9545242630824'
              }
          },
          compilers: {
              solc: {
                  version: "0.4.25"
              }
          }
      };
---

Degno di nota! Devi esserti esercitato.

Ora, questo tutorial non sarebbe completo senza mostrarti come testare la Testnet di **_Loom_**.

Ricordiamo dalle nostre lezioni precedenti che, su **_Loom_**, gli utenti hanno accesso a transazioni molto più veloci e senza gas rispetto a **Ethereum**. Ciò rende DAppChains molto più adatto a qualcosa come un gioco o una DApp rivolta all'utente.

E tu sai cosa? La distribuzione e il test su **Loom** non sono affatto diversi. Siamo andati avanti e abbiamo riassunto ciò che è necessario per fare dei test su **_Loom_**. Diamo una rapida occhiata.

## Configurare Truffle per eseguire test su **Loom**

Cominciando dall'inizio. Diciamo a Truffle come distribuire sulla Testnet di Loom inserendo il seguente snippet all'interno dell'oggetto `networks`.

```javascript
    loom_testnet: {
      provider: function() {
        const privateKey = 'YOUR_PRIVATE_KEY';
        const chainId = 'extdev-plasma-us1';
        const writeUrl = 'wss://extdev-basechain-us1.dappchains.com/websocket';
        const readUrl = 'wss://extdev-basechain-us1.dappchains.com/queryws';
        return new LoomTruffleProvider(chainId, writeUrl, readUrl, privateKey);
      },
      network_id: 'extdev'
    }
```

> Nota: non rivelare mai la tua chiave privata! Lo stiamo facendo solo per semplicità. Una soluzione molto più sicura sarebbe salvare la tua chiave privata in un file e leggerne il valore da quel file. Se lo fai, assicurati di evitare di eseguire il push del file in cui hai salvato la tua chiave privata su GitHub, dove chiunque può vederla.

## L'array Accounts

Per fare in modo che _Truffle_ possa comunicare con **Loom** abbiamo sostituito il predefinito "HDWalletProvider" con il nostro <a href="https://github.com/loomnetwork/loom-truffle-provider" target=_blank >Loom Truffle Provider</a>. Di conseguenza, dobbiamo dire al nostro provider di compilare l'array "accounts" in modo da poter testare il nostro gioco. Per fare ciò, siamo tenuti a sostituire la riga di codice `return a new LoomTruffleProvider`:

```javascript
return new LoomTruffleProvider(chainId, writeUrl, readUrl, privateKey);
```

con:

```javascript
const loomTruffleProvider = new LoomTruffleProvider(
	chainId,
	writeUrl,
	readUrl,
	privateKey
);
loomTruffleProvider.createExtraAccountsFromMnemonic(mnemonic, 10);
return loomTruffleProvider;
```

# Testiamo

1. Sostituisci la riga di codice che `return a new LoomTruffleProvider` con lo snippet dall'alto.

C'è un'altra cosa di cui dovremmo occuparci. Il viaggio nel tempo è disponibile solo durante il test su _Ganache_, quindi dovremmo saltare questo test. Sai già come _saltare_ un test mettendo una `x` davanti al nome della funzione. Tuttavia, questa volta vogliamo che tu impari qualcosa di nuovo. Per farla breve... puoi _saltare_ un test semplicemente concatenando una chiamata di funzione `skip()` come segue:

```javascript
it.skip('zombies should be able to attack another zombie', async () => {
	//We're skipping the body of the function for brevity
});
```

Siamo andati avanti e abbiamo saltato il test per te. Quindi, abbiamo eseguito `truffle test --network loom_testnet`.

Se inserisci i comandi dall'alto, l'output dovrebbe essere simile a questo:

```bash
Contract: CryptoZombies
    ✓ should be able to create a new zombie (6153ms)
    ✓ should not allow two zombies (12895ms)
    ✓ should return the correct owner (6962ms)
    - zombies should be able to attack another zombie
    with the single-step transfer scenario
      ✓ should transfer a zombie (13810ms)
    with the two-step transfer scenario
      ✓ should approve and then transfer a zombie when the approved address calls transferFrom (22388ms)


  5 passing (2m)
  1 pending
```

Per ora è tutto, gente! Abbiamo finito di testare il nostro contratto intelligente "CryptoZombie".
