---
title:  マイグレーション
actions: ['答え合わせ', 'ヒント']
requireLogin: true
material:
  editor:
    language: JavaScript
    startingCode:
      "./contracts/2_crypto_zombies.js": |
        var Migrations = artifacts.require("./Migrations.sol");
        module.exports = function(deployer) {
          deployer.deploy(Migrations);
        };
    answer: |
      var CryptoZombies = artifacts.require("./CryptoZombies.sol");
      module.exports = function(deployer) {
        deployer.deploy(CryptoZombies);
      };
---

通常であれば、 **_Ethereum_** にデプロイする前の時点で、スマートコントラクトをテストしたくなるだろう。<a href="https://truffleframework.com/ganache" target=”_blank”>Ganache</a>というツールを使って、 **_Ethereum_** のネットワークをローカル環境に構築することができる。

テストは非常に重要ではあるが、その説明には膨大なレッスンが必要となる - だからこのレッスンではデプロイに集中するぞ。テストについて詳しく知りたければ、<a href="http://cryptozombies.io/jp/lesson/10" target=”_blank”>Testing Smart Contracts with Truffle</a>というレッスンを用意しておるぞ。

<!-- TODO: update ^^ link, if needed -->

**_Ethereum_** にデプロイするには、 **マイグレーション** と呼ばれるものを作成しなければならない。

マイグレーションはJavaScriptで書かれ、 **Truffle** が **_Ethereum_** にデプロイする手助けをしておる。`truffle init`コマンドで作成された`Migrations.sol`という名の特別なコントラクトが、お前がコードに加えた変更を追跡していることに注意せよ。このコントラクトは、変更履歴をオンチェーンに保存しておる。従って、同じコードを２度デプロイすることはできないぞ。

## 新しいマイグレーションを作成する

`truffle init`がすでに作成してくれておるファイルを使うぞ - `./contracts/1_initial_migration.js`だ。
中身を見てみようではないか:

```javascript
var Migrations = artifacts.require("./Migrations.sol");
module.exports = function(deployer) {
  deployer.deploy(Migrations);
};
```

ものすごく直感的であろう？

１行目で `Migrations` コントラクトと対話したいと **Truffle** に伝えている。

２行目で`deployer`というオブジェクトをパラメータとして受け取る関数をエクスポートしている。このオブジェクトは、お前（開発者）と **Truffle** のデプロイメントエンジンの間のインターフェースとしての役割をしておる。`deployer`は多数の便利機能を提供しているが、このレッスンでは扱わないぞ。 **Truffle** の能力をもっと知りたければ、終わった後で **Truffle** の<a href="https://truffleframework.com/docs/truffle/getting-started/running-migrations" target=”_blank”>ドキュメント</a>をチェックするがいい。

デプロイに必要なものは揃った。新しいファイル `./contracts/2_crypto_zombies.js` を作成し、`./contracts/1_initial_migration.js` の中身をコピペするぞ。

# さあテストだ

1. `./contracts/2_crypto_zombies.js` を次のように編集せよ:

```JavaScript
var CryptoZombies = artifacts.require("./CryptoZombies.sol");
module.exports = function(deployer) {
  deployer.deploy(CryptoZombies);
};
```
