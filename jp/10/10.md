---
title: Basechainにデプロイする
actions: ['答え合わせ', 'ヒント']
requireLogin: true
material:
  terminal:
    help:
      You should probably run `truffle migrate --network basechain`.
    commands:
        "truffle migrate --network basechain":
            hint: truffle migrate --network basechain
            output: |
              Starting migrations...
              ======================
              > Network name:    'basechain'
              > Network id:      13654820909954
              > Block gas limit: 0


              1_initial_migration.js
              ======================

                Replacing 'Migrations'
                ----------------------
                > transaction hash:    0x5aaab85541e843d54926612e0b4f5faf2d48df8ad461b5f0de571565cabe8dc6
                > Blocks: 0            Seconds: 0
                > contract address:    0xc0eCB06312a20f9435E6Ed3B7eFD7bc0c0865BF2
                > account:             0xE046eB99Cbe99d6760ff01304E25F1dD9116F558
                > balance:             0
                > gas used:            0
                > gas price:           0 gwei
                > value sent:          0 ETH
                > total cost:          0 ETH


                > Saving migration to chain.
                > Saving artifacts
                -------------------------------------
                > Total cost:                   0 ETH

                2_crypto_zombies.js
                =================

                  Replacing 'CryptoZombies'
                  -----------------------
                  > transaction hash:    0xeed20de79685ab845e1e848bb871ce87d2fc532d7c87f40b9b25f2bf75b4e3a8
                  > Blocks: 0            Seconds: 0
                  > contract address:    0xDf2986bbDa42404C8f43A5851aF887B2A3a9CFaB
                  > account:             0xE046eB99Cbe99d6760ff01304E25F1dD9116F558
                  > balance:             0
                  > gas used:            0
                  > gas price:           0 gwei
                  > value sent:          0 ETH
                  > total cost:          0 ETH


                  > Saving migration to chain.
                  > Saving artifacts
                  -------------------------------------
                  > Total cost:                   0 ETH

              

---

やったな！ **_Loom_** のテストネットにデプロイできたぞ。次は何をするか思いつくか？🤔

そう、正解だ！このチャプターでは、 **_Basechain_** にデプロイするぞ（これがメインネットだ）。

このチャプターでやることを要約するとこうだ:

- 新たな秘密鍵を作成する。
- 新たな秘密鍵は極めて簡単に作れる。しかしメインネットへのデプロイで伝えた通り、セキュリティにシビアになる時だ。 **Truffle** に安全に秘密鍵を渡す方法を授けてやろう。
- **_Basechain_** へのデプロイ方法を **Truffle** に伝えるため、定義ファイル `truffle.js` に新たなオブジェクトを追加する。
- デプロイキーをホワイトリストに追加し、 **_Basechain_** へデプロイできるようにする。
- 最後に、スマートコントラクトを実際にデプロイする。

### 新たな秘密鍵を作成する

お前はすでに秘密鍵の作成方法を知っているな。しかし、今回はファイル名を変えなければならない:

```bash
./loom genkey -a mainnet_public_key -k mainnet_private_key
local address: 0x07419790A773Cc6a2840f1c092240922B61eC778
local address base64: B0GXkKdzzGooQPHAkiQJIrYex3g=
```

### Truffleに安全に秘密鍵を渡す

次にすることは、秘密鍵がGitHubにプッシュされてしまうことを防ぐことだ。 `.gitignore` という新しいファイルを作るぞ:

```bash
touch .gitignore
```

さあ、秘密鍵を保存したファイルを無視するよう、GitHubに「伝え」よう。次のコマンドを叩くのだ:

```bash
echo mainnet_private_key >> .gitignore
```

これで我々の秘密がGitHubにプッシュされる恐れはなくなった。定義ファイル `truffle.js` を編集し、 **Truffle** がこの秘密のファイルから秘密鍵を読み取れるようにしなければならない。

手始めにいくつかインポートするぞ:

```js
const { readFileSync } = require('fs')
const path = require('path')
const { join } = require('path')
```

次に、関数を定義したい。この関数はファイルから秘密鍵を読み取り、 `LoomTruffleProvider` のインスタンスを返すぞ:

```js
function getLoomProviderWithPrivateKey (privateKeyPath, chainId, writeUrl, readUrl) {
  const privateKey = readFileSync(privateKeyPath, 'utf-8');
  return new LoomTruffleProvider(chainId, writeUrl, readUrl, privateKey);
}
```

簡単だろう？

### Basechainへのデプロイ方法をTruffleに伝える

**Truffle** に **_Basechain_** へのデプロイ方法を伝えないとな。新しいオブジェクトを `truffle.js` に追加するぞ！

```js
basechain: {
  provider: function() {
    const chainId = 'default';
    const writeUrl = 'http://basechain.dappchains.com/rpc';
    const readUrl = 'http://basechain.dappchains.com/query';
    const privateKeyPath = path.join(__dirname, 'mainnet_private_key');
    const loomTruffleProvider = getLoomProviderWithPrivateKey(privateKeyPath, chainId, writeUrl, readUrl);
    return loomTruffleProvider;
    },
  network_id: '*'
}
```

この時点で、`truffle.js` ファイルは次のような見た目になっているはずだ:

```js
// Initialize HDWalletProvider
const HDWalletProvider = require("truffle-hdwallet-provider");

const { readFileSync } = require('fs')
const path = require('path')
const { join } = require('path')


// Set your own mnemonic here
const mnemonic = "YOUR_MNEMONIC";

function getLoomProviderWithPrivateKey (privateKeyPath, chainId, writeUrl, readUrl) {
  const privateKey = readFileSync(privateKeyPath, 'utf-8');
  return new LoomTruffleProvider(chainId, writeUrl, readUrl, privateKey);
}

// Module exports to make this configuration available to Truffle itself
module.exports = {
  // Object with configuration for each network
  networks: {
    // Configuration for mainnet
    mainnet: {
      provider: function () {
        // Setting the provider with the Infura Rinkeby address and Token
        return new HDWalletProvider(mnemonic, "https://mainnet.infura.io/v3/YOUR_TOKEN")
      },
      network_id: "1"
    },
    // Configuration for rinkeby network
    rinkeby: {
      // Special function to setup the provider
      provider: function () {
        // Setting the provider with the Infura Rinkeby address and Token
        return new HDWalletProvider(mnemonic, "https://rinkeby.infura.io/v3/YOUR_TOKEN")
      },
      // Network id is 4 for Rinkeby
      network_id: 4
    },

    basechain: {
      provider: function() {
        const chainId = 'default';
        const writeUrl = 'http://basechain.dappchains.com/rpc';
        const readUrl = 'http://basechain.dappchains.com/query';
        const privateKeyPath = path.join(__dirname, 'mainnet_private_key');
        const loomTruffleProvider = getLoomProviderWithPrivateKey(privateKeyPath, chainId, writeUrl, readUrl);
        return loomTruffleProvider;
        },
      network_id: '*'
    }
  }
};
```

### デプロイキーをホワイトリストに追加する

**_Basechain_** にデプロイする前に、<a href="https://loomx.io/developers/en/deploy-loom-mainnet.html" target=_blank>Deploy to Mainnet</a>ガイドに従ってデプロイキーをホワイトリストに追加する必要がある。心配はいらないぞ。これをしなければならないことを覚えておけばいい。

これら全ての手順を終えたら、 **_Basechain_** にデプロイする準備は完了だ！

# さあテストだ

1. `truffle migrate --network basechain`コマンドを叩け。

素晴らしい。お前のスマートコントラクトをBasechainにデプロイできたぞ！👏🏻
